<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Para Ti 💖</title>
  <meta name="description" content="Un detallito web hecho con amor." />
  <meta name="theme-color" content="#0f0f14">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta property="og:title" content="Para Ti 💖">
  <meta property="og:description" content="Un detallito web hecho con amor.">
  <meta property="og:type" content="website">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128'%3E%3Ctext y='96' x='16' font-size='96'%3E%F0%9F%92%96%3C/text%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f0f14; --card:#151521; --ink:#ffffff; --muted:#cbd5e1;
      --brand:#ff4d8d; --brand-2:#ffafcc; --accent:#7dd3fc;
      --glow:0 0 40px rgba(255,77,141,.35),0 0 8px rgba(255,77,141,.65);
      --radius:22px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%}
    body{
      font:16px/1.55 "Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 800px at 85% -10%,rgba(125,211,252,.18),transparent 60%),
        radial-gradient(800px 500px at -10% 10%,rgba(255,175,204,.14),transparent 60%),
        var(--bg);
      color:var(--ink);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:20px 18px 80px}
    header{position:sticky;top:0;background:linear-gradient(180deg,rgba(15,15,20,.9),rgba(15,15,20,.55) 60%,transparent);backdrop-filter:saturate(130%) blur(8px);z-index:50}
    .nav{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .heart{width:34px;height:34px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff,#ffd1e1 30%,#ff7aa5 60%,#ff4d8d 80%);box-shadow:var(--glow)}
    .title{font-weight:800;letter-spacing:.5px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.06);color:#fff;border:1px solid rgba(255,255,255,.08);cursor:pointer}
    .tab[aria-current="true"]{background:var(--brand);border-color:#ff8fb4;color:#12121b;box-shadow:var(--glow)}

    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:20px;align-items:center;margin:22px 0}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:20px;box-shadow:0 4px 30px rgba(0,0,0,.25)}
    .hero h1{font-size:clamp(28px,5vw,48px);margin:6px 0 8px}
    .hero p{color:var(--muted);margin:0}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1)}
    .cta{display:flex;gap:10px;margin-top:16px;flex-wrap:wrap}
    .btn{padding:12px 16px;border-radius:14px;border:1px solid rgba(255,255,255,.1);background:#1b1b27;color:#fff;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,var(--brand),#ff7aa5);border-color:#ff9ec3;color:#12121b;box-shadow:var(--glow)}

    .floaters{position:relative;min-height:260px;overflow:hidden;border-radius:var(--radius)}
    .floater{position:absolute;bottom:-40px;font-size:18px;animation:rise var(--d) linear infinite;opacity:.85;filter:drop-shadow(0 6px 10px rgba(255,77,141,.25))}
    @keyframes rise{from{transform:translateY(40px)}to{transform:translateY(-320px) rotate(20deg)}}

    section{scroll-margin-top:90px;margin-top:28px}
    h2{margin:0 0 10px}
    .muted{color:var(--muted)}

    .type{min-height:120px;white-space:pre-wrap}
    .cursor{display:inline-block;width:10px;background:#ff8fb4;margin-left:2px;animation:blink 1s steps(2,end) infinite}
    @keyframes blink{50%{background:transparent}}

    .grid{display:grid;gap:14px}
    .grid.m3{grid-template-columns:repeat(3,1fr)}
    .grid.m2{grid-template-columns:repeat(2,1fr)}
    @media (max-width:900px){.hero{grid-template-columns:1fr}.grid.m3{grid-template-columns:1fr 1fr}}
    @media (max-width:620px){.grid.m2,.grid.m3{grid-template-columns:1fr}}
    .reason{padding:16px;border-radius:18px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)}

    .timeline{position:relative;padding-left:18px}
    .timeline::before{content:"";position:absolute;left:6px;top:0;bottom:0;width:2px;background:linear-gradient(var(--brand),transparent)}
    .step{position:relative;margin:16px 0;padding-left:8px}
    .dot{position:absolute;left:-2px;top:4px;width:12px;height:12px;border-radius:50%;background:var(--brand);box-shadow:0 0 0 4px rgba(255,77,141,.15)}

    .gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    @media (max-width:800px){.gallery{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:520px){.gallery{grid-template-columns:1fr}}
    .ph{position:relative;border-radius:16px;overflow:hidden;aspect-ratio:4/3;background:linear-gradient(135deg,#1e1e2b,#232336);border:1px solid rgba(255,255,255,.08);display:grid;place-items:center;color:#a5b4fc}
    .ph img{width:100%;height:100%;object-fit:cover;display:block}
    .ph button{position:absolute;bottom:8px;right:8px}

    dialog{border:none;border-radius:18px;max-width:min(92vw,900px);background:#0f0f14}
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .full img{max-width:92vw;max-height:80vh;border-radius:14px}

    /* Palabras */
    .palabras-form{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
    .burbujas{display:flex;flex-wrap:wrap;gap:8px}
    .burbuja{padding:10px 14px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);display:inline-flex;gap:8px;align-items:center;transform:rotate(var(--rot,0deg))}
    .burbuja .x{border:none;background:transparent;color:#ffafcc;cursor:pointer}

    .hidden{display:none !important}
    .confetti{position:fixed;inset:0;pointer-events:none;overflow:hidden}
    .piece{position:absolute;width:10px;height:16px;opacity:.9;animation:fall linear forwards}
    @keyframes fall{to{transform:translateY(110vh) rotate(720deg);opacity:1}}

    @media (prefers-reduced-motion: reduce){
      * { animation-duration:.001ms !important; animation-iteration-count:1 !important; transition:none !important; }
      .floater, .confetti { display:none !important; }
    }
    @media print{
      header, nav, .tabs, #btn-replay, #btn-compartir, #btn-ajustes, .cta { display:none !important; }
      body{ background:#fff; color:#000; }
      .card{ box-shadow:none; border:1px solid #ddd; }
      a{ color:#000; }
    }
    footer{margin-top:32px;color:#9aa2b2;text-align:center}
    footer a{color:#cbd5e1}
  </style>
</head>
<body>

  <!-- Hard refresh -->
  <script>
  const APP_VERSION = '23';
  (async () => {
    try {
      const prev = localStorage.getItem('app_version');
      if (prev !== APP_VERSION) {
        if ('caches' in window) { for (const k of await caches.keys()) await caches.delete(k); }
        if ('serviceWorker' in navigator) { const regs = await navigator.serviceWorker.getRegistrations(); for (const r of regs) await r.unregister(); }
        localStorage.setItem('app_version', APP_VERSION);
        const sep = location.search ? '&' : '?';
        location.replace(location.pathname + location.search + sep + 'v=' + APP_VERSION);
      } else {
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.addEventListener('controllerchange', () => location.reload());
          navigator.serviceWorker.getRegistration().then(r => r?.update?.());
        }
      }
    } catch (e) {}
  })();
  </script>

  <header>
    <div class="wrap nav">
      <div class="brand"><div class="heart" aria-hidden="true"></div><div class="title">Para <span id="nombre-dest">Ti</span> 💖</div></div>
      <nav class="tabs" aria-label="Secciones">
        <button class="tab" data-go="#carta" aria-current="true">Carta</button>
        <button class="tab" data-go="#motivos">Motivos</button>
        <button class="tab" data-go="#momentos">Momentos</button>
        <button class="tab" data-go="#galeria">Galería</button>
        <button class="tab" data-go="#ruleta">Ruleta</button>
        <button class="tab" data-go="#palabras">Palabras</button>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <div class="hero">
      <div class="card">
        <span class="pill">Hecho con amor por <strong id="nombre-rem">mí</strong> ✨</span>
        <h1 id="hero-title">Eres mi persona favorita</h1>
        <p id="hero-sub" class="muted">Abrí esta página para decirte, de mil formas, lo mucho que te amo.</p>
        <div class="cta">
          <button class="btn primary" id="btn-scroll">Léela ahora</button>
          <button class="btn" id="btn-compartir">Compartir</button>
          <button class="btn" id="btn-ajustes">Editar nombres</button>
        </div>
      </div>
      <div class="card floaters" aria-hidden="true" id="floaters"></div>
    </div>

    <!-- CARTA -->
    <section id="carta" class="card">
      <h2>💌 Carta</h2>
      <div class="type" id="type" aria-live="polite"></div><span class="cursor" id="cursor"></span>
      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn" id="btn-replay">Repetir carta</button>
        <button class="btn" onclick="window.print()">Imprimir/Guardar PDF</button>
      </div>
    </section>

    <!-- MOTIVOS -->
    <section id="motivos" class="card">
      <h2>🌟 Cosas que amo de ti</h2>
      <div class="grid m3" id="reasons"></div>
    </section>

    <!-- MOMENTOS -->
    <section id="momentos" class="card">
      <h2>🗓️ Nuestros momentos</h2>
      <div class="timeline" id="timeline"></div>
    </section>

    <!-- GALERÍA -->
    <section id="galeria" class="card">
      <h2>📷 Galería</h2>
      <p class="muted">Toca para ver en grande. Usa ⟨ / ⟩ o ← / → para cambiar.</p>
      <div class="gallery" id="gal"></div>

      <dialog id="lightbox">
        <div class="full" style="position:relative;display:flex;align-items:center;justify-content:center">
          <button class="btn" onclick="cambiarFoto(-1)" style="position:absolute;left:10px">⟨</button>
          <img alt="" id="fullimg">
          <button class="btn" onclick="cambiarFoto(1)" style="position:absolute;right:10px">⟩</button>
        </div>
      </dialog>
    </section>

    <!-- RULETA -->
    <section id="ruleta" class="card">
      <h2>🎡 Ruleta de cumplidos</h2>
      <p id="cumplido" class="muted">Pulsa “Girar” para descubrir un cumplido 💞</p>
      <div class="cta">
        <button class="btn primary" id="btn-ruleta">Girar</button>
        <button class="btn" id="btn-reset-ruleta">Reiniciar</button>
      </div>
      <small class="muted">No se repiten hasta mostrar todos. Se guarda tu progreso.</small>
    </section>

    <!-- PALABRAS -->
    <section id="palabras" class="card">
      <h2>💬 Palabras que te describen</h2>
      <div class="palabras-form">
        <input id="palabra-text" class="btn" type="text" placeholder="Ej. Valiente, brillante, dulce..." />
        <button class="btn primary" id="palabra-add">Agregar</button>
        <button class="btn" id="palabra-sugerir">Sugerir 5</button>
        <button class="btn" id="palabra-clear">Limpiar todo</button>
      </div>
      <div id="burbujas" class="burbujas"></div>
      <small class="muted">Consejo: agrega adjetivos o apodos bonitos. Toca la ✕ para borrar alguno.</small>
    </section>

    <footer>
      Hecho con 💖 por <span id="pie-rem">alguien que te ama</span> · <a href="#" id="copylink">Copiar link</a>
    </footer>
  </div>

  <div class="confetti" id="confetti" aria-hidden="true"></div>

  <!-- Diálogo de ajustes -->
  <dialog id="dlg-ajustes">
    <div class="card" style="padding:18px;max-width:520px">
      <h3>Personalizar 💖</h3>
      <label>Para: <input id="inp-para" class="btn" style="width:100%;margin-top:6px"></label>
      <label style="margin-top:10px">De: <input id="inp-de" class="btn" style="width:100%;margin-top:6px"></label>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:14px">
        <button class="btn" id="aj-cancel">Cancelar</button>
        <button class="btn primary" id="aj-guardar">Guardar</button>
      </div>
    </div>
  </dialog>

  <script>
    // ========= util =========
    const qs=(s,p=document)=>p.querySelector(s);
    const qsa=(s,p=document)=>[...p.querySelectorAll(s)];
    const params=new URLSearchParams(location.search);

    // Nombres
    const nombre = params.get('para') || localStorage.getItem('para') || 'Ti';
    const de = params.get('de') || localStorage.getItem('de') || 'mí';
    localStorage.setItem('para', nombre);
    localStorage.setItem('de', de);

    // header + hero
    qs('#nombre-dest').textContent = nombre;
    qs('#nombre-rem').textContent = de;
    qs('#pie-rem').textContent = de;

    // corazones flotantes
    const floaters = qs('#floaters');
    const EMOJIS=['💖','💗','💓','💞','💘','💝','💕','❤️'];
    for(let i=0;i<26;i++){
      const e=document.createElement('div');
      e.className='floater';
      e.style.left=Math.random()*92+"%";
      e.style.setProperty('--d', (6+Math.random()*8)+'s');
      e.textContent=EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
      floaters.appendChild(e);
    }

    // tabs scroll
    qsa('.tab').forEach(t=>t.addEventListener('click',()=>{
      qsa('.tab').forEach(x=>x.removeAttribute('aria-current'));
      t.setAttribute('aria-current','true');
      const id=t.getAttribute('data-go');
      location.hash=id;
      document.querySelector(id).scrollIntoView({behavior:'smooth'});
    }));
    qs('#btn-scroll').onclick=()=>document.querySelector('#carta').scrollIntoView({behavior:'smooth'});

    // compartir
    function linkConNombre(){
      const u=new URL(location.href);
      u.searchParams.set('para', nombre);
      u.searchParams.set('de', de);
      return u.toString();
    }
    async function copiar(texto){
      try{ await navigator.clipboard.writeText(texto); }
      catch{
        const ta=document.createElement('textarea'); ta.value=texto; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
      }
      alert('¡Link copiado!');
    }
    qs('#btn-compartir').onclick=async ()=>{
      const url = linkConNombre();
      const text = `Para ${nombre} 💖\nAbrí esto que hice para ti:\n${url}`;
      if (navigator.share){
        try{ await navigator.share({title:'Para Ti 💖', text, url}); }catch{}
      }else{
        const wa = `https://wa.me/?text=${encodeURIComponent(text)}`;
        window.open(wa, '_blank');
      }
    };
    qs('#copylink').onclick=(e)=>{e.preventDefault(); copiar(location.href)};

    // CARTA (con tus recuerdos)
    const textoCarta = `Hola ${nombre}:

Hoy me detuve a pensar en nosotros y en todo lo que hemos vivido. En cómo un “hola” sencillo se volvió el inicio de una historia que me hace sonreír incluso en los días difíciles. Me gusta la forma en la que llegas, sin ruido, y de pronto todo se siente más ligero. Me gusta cuando te ríes fuerte, cuando te quedas en silencio y también cuando me cuentas cualquier cosa aunque sea mínima; me gusta porque eres tú.

Gracias por la paciencia y por los detalles pequeños: los mensajes de buenos días, las llamadas de “ya llegué”, las fotos tontas y los abrazos que arreglan semanas enteras. Gracias por creer en lo que somos y por cuidarlo con tanto cariño. A tu lado aprendí que el amor también es calma, equipo y ganas de construir poquito a poquito.

Y me emocionan nuestros recuerdos: aquella vez que nos agarró la lluvia en la calle y terminamos riéndonos como niños, las salidas de compras que empiezan con “solo veremos” y acaban con bolsitas y anécdotas, nuestras idas por café donde el mundo se pausa un ratito, y las comidas juntos en las que el tiempo se nos va entre historias y miradas. Son momentos sencillos, pero contigo se vuelven mis favoritos.

Quiero seguir eligiéndote en lo cotidiano: en las caminatas sin prisa, en las películas que no terminamos porque nos gana la plática, en los planes locos que inventamos y en los domingos de flojera que se sienten a hogar. Quiero estar en tus metas y en tus victorias, pero también sostenerte cuando te canses; prometo celebrar tus logros como míos y recordarte lo valiosa que eres cuando a ti se te olvide.

Sueño con lo que viene: con viajes, con fotos nuevas, con una casa que huela a risa, con nuestro “para siempre” hecho de momentos simples. No necesito promesas perfectas; me basta con seguir tomándote la mano y decirte cada día que aquí estoy, que te elijo y que contigo me quedo.

Gracias por existir y por enseñarme un amor bonito, paciente y verdadero. Eres mi coincidencia más preciosa, mi risa favorita y el lugar donde me siento en casa.

Con amor,
${de}`;
    const box=qs('#type'); const cursor=qs('#cursor');
    let idx=0, timer=null;
    function escribir(){
      clearInterval(timer); box.textContent=''; idx=0; cursor.style.display='inline-block';
      timer=setInterval(()=>{ if(idx>=textoCarta.length){ clearInterval(timer); cursor.style.display='none'; return; } box.textContent+=textoCarta[idx++]; },25);
    }
    escribir(); qs('#btn-replay').onclick=escribir;

    // MOTIVOS (18)
    const MOTIVOS=[
      ['Tu risa','Me alegra el día sin importar nada.'],
      ['Tu mirada','Me da paz y me recuerda por qué vale la pena todo.'],
      ['Cómo me escuchas','Siento que soy visto y entendido por ti.'],
      ['Tus abrazos','Ahí cabe el mundo y me siento en casa.'],
      ['Tu inteligencia','Admiro tu forma de resolver y aprender.'],
      ['Tu paciencia','Gracias por quedarte incluso cuando el camino se pone difícil.'],
      ['Tu sentido del humor','Haces más ligeros los días pesados.'],
      ['Tu manera de bailar','Hasta una canción tonta se vuelve especial.'],
      ['Tu aroma','Huele a hogar.'],
      ['Tu responsabilidad','Cumples, cuidas y das tu mejor versión.'],
      ['Cómo cuidas a tu familia','Me enseña el tamaño de tu corazón.'],
      ['Tu fortaleza','Te caes, te levantas y sigues brillando.'],
      ['Tu creatividad','Siempre encuentras formas bonitas de sorprenderme.'],
      ['Tus mensajes','Llegan justo cuando los necesito.'],
      ['Cómo me motivas','Contigo creo más en mí.'],
      ['Nuestros planes','Desde lo pequeño hasta lo grande, contigo todo es especial.'],
      ['Nuestros silencios','También hablan de amor.'],
      ['Nosotros','Porque lo nuestro es equipo, compañía y amor.']
    ];
    const reasons=qs('#reasons');
    MOTIVOS.forEach(([t,d])=>{
      const c=document.createElement('div');
      c.className='reason';
      c.innerHTML=`<strong>${t}</strong><p class="muted" style="margin:6px 0 0">${d}</p>`;
      reasons.appendChild(c);
    });

    // MOMENTOS (incluye lluvia, compras, café y comida juntos)
    const MOMENTOS=[
      ['Nos vimos por primera vez','Y el mundo hizo un ruidito de “clic”.'],
      ['Primer mensaje largo','La conversación que no queríamos que termine.'],
      ['Primera llamada hasta dormirnos','Descubrimos que las madrugadas también son nuestras.'],
      ['La lluvia que nos sorprendió','Acabamos empapados y riendo como niños.'],
      ['De compras “solo a ver”','Y volvimos con bolsitas y mil anécdotas.'],
      ['Nuestro café favorito','Un ratito en pausa para los dos.'],
      ['Comer juntos','Plática, miradas y un montón de ganas de quedarnos.'],
      ['La primera salida','Las mariposas confirmaron lo que ya sabíamos.'],
      ['Nuestro lugar favorito','Ese sitio que ahora se siente como casa.'],
      ['Plan improvisado perfecto','Porque lo inesperado contigo siempre sale bien.'],
      ['Nuestro futuro','Lo bonito que estamos construyendo juntos.']
    ];
    const tl=qs('#timeline');
    MOMENTOS.forEach(([t,d])=>{
      const s=document.createElement('div');
      s.className='step';
      s.innerHTML=`<div class="dot"></div><strong>${t}</strong><div class="muted">${d}</div>`;
      tl.appendChild(s);
    });

    // ========= GALERÍA =========
    const IMAGENES_META = [
      { base: ['numero1'],              alt: '95, siempre serás mi número 1' },
      { base: ['nina-bebe'],            alt: 'Foto de bebé' },
      { base: ['selfie-champion'],      alt: 'Selfie con sudadera Champion gris' },
      { base: ['con-gatito'],           alt: 'Con su gatito' },
      { base: ['retrato-rosa'],         alt: 'Retrato con fondo rosa' },
      { base: ['sombrero-cuadros'],     alt: 'Sombrero y camisa a cuadros' },
      { base: ['nino-escuela','ni%C3%B1o-escuela'], alt: 'Infancia en la escuela' },
      { base: ['carrusel'],             alt: 'Niña en carrusel' },
      { base: ['selfie-espejo-iphone'], alt: 'Selfie en espejo con iPhone' },
      { base: ['collage'],              alt: 'Collage de recuerdos' },
      { base: ['selfie-hoodie'],        alt: 'Selfie con capucha gris' },
      { base: ['selfie-liston-flores'], alt: 'Selfie con listón de flores' },
      { base: ['selfie-sonrisa'],       alt: 'Selfie sonriente' }
    ];
    const EXTS = ['.jpg','.jpeg','.png','.JPG','.JPEG','.PNG'];
    const VERSION='v13';
    const gal=qs('#gal');
    const RESUELTAS = new Array(IMAGENES_META.length).fill(null);

    function testSrc(url){
      return new Promise(resolve=>{
        const img=new Image();
        img.onload = ()=>resolve(true);
        img.onerror= ()=>resolve(false);
        img.src = url;
      });
    }
    async function resolveImagePath(bases){
      const tried=[];
      for(const b of bases){
        for(const ext of EXTS){
          const url=`img/${b}${ext}?${VERSION}`;
          tried.push(url);
          if(await testSrc(url)) return {url,tried};
        }
      }
      return {url:null,tried};
    }
    (async function buildGallery(){
      for(let i=0;i<IMAGENES_META.length;i++){
        const {base,alt}=IMAGENES_META[i];
        const ph=document.createElement('div'); ph.className='ph';
        const img=document.createElement('img'); img.loading='lazy'; img.alt=alt;
        const b=document.createElement('button'); b.className='btn'; b.textContent='Ver'; b.disabled=true; b.style.opacity=.7;
        ph.append(img,b); gal.appendChild(ph);
        const {url,tried}=await resolveImagePath(base);
        if(url){ RESUELTAS[i]=url; img.src=url; b.disabled=false; b.style.opacity=1; b.onclick=()=>abrirLightbox(i); }
        else{
          ph.style.border='2px solid #f87171';
          ph.innerHTML=`<div style="padding:10px;text-align:center">
            <div style="font-weight:600;color:#fecaca">No se pudo cargar</div>
            <div class="muted" style="font-size:12px;word-break:break-all">${tried.join('<br>')}</div>
          </div>`;
        }
      }
    })();

    const dlg=qs('#lightbox'); const full=qs('#fullimg'); let fotoActual=0;
    function abrirLightbox(i){ if(!RESUELTAS[i]) return; fotoActual=i; full.src=RESUELTAS[i]; full.alt=IMAGENES_META[i].alt; dlg.showModal(); }
    function cambiarFoto(dir){
      let next=fotoActual;
      for(let k=0;k<IMAGENES_META.length;k++){
        next=(next+dir+IMAGENES_META.length)%IMAGENES_META.length;
        if(RESUELTAS[next]){ fotoActual=next; full.src=RESUELTAS[next]; full.alt=IMAGENES_META[next].alt; break; }
      }
    }
    dlg.addEventListener('click',e=>{ if(e.target.tagName==='DIALOG') dlg.close(); });
    window.addEventListener('keydown',e=>{ if(!dlg.open) return; if(e.key==='ArrowRight') cambiarFoto(1); if(e.key==='ArrowLeft') cambiarFoto(-1); if(e.key==='Escape') dlg.close(); });

    // ========= Confetti =========
    function confetti(){
      const wrap=qs('#confetti');
      const colors=['#ff4d8d','#ffafcc','#7dd3fc','#a7f3d0','#fde68a'];
      for(let i=0;i<200;i++){
        const p=document.createElement('div'); p.className='piece';
        const x=Math.random()*100; const d=6+Math.random()*5; const color=colors[i%colors.length];
        p.style.left=x+'vw'; p.style.top='-5vh'; p.style.background=color;
        p.style.transform=`translateY(0) rotate(${Math.random()*360}deg)`; p.style.animationDuration=d+'s';
        p.style.width=(6+Math.random()*8)+'px'; p.style.height=(8+Math.random()*16)+'px';
        p.style.animationTimingFunction='cubic-bezier(.12,.4,.29,.99)';
        wrap.appendChild(p); setTimeout(()=>p.remove(), d*1000);
      }
    }

    // ========= Ruleta de cumplidos =========
    const CUMPLIDOS_KEY='ruleta_v2';
    const CUMPLIDOS_BASE=[
      'Tu sonrisa es mi lugar favorito.','Eres el mejor pedacito de mi día.','Tu voz me calma como nada más.',
      'Me gusta quién soy cuando estoy contigo.','Tu risa me recuerda que todo estará bien.','Gracias por enseñarme un amor bonito.',
      'Tus ojos tienen un brillo que no se apaga.','Eres magia en un mundo de prisa.','Todo es más fácil a tu lado.',
      'Tus abrazos arreglan semanas enteras.','Me encanta cuando te emocionas por cosas pequeñas.','Eres paciente y dulce, una combinación perfecta.',
      'Tu forma de pensar me inspira.','Admiro tu fuerza y tu corazón enorme.','Eres mi mensaje favorito del día.',
      'Me haces creer en la suerte y en el destino.','Tu alegría es contagiosa.','Me encantan tus ocurrencias.',
      'Tienes una luz única.','Me haces sentir en casa.','Eres mi persona para siempre.','Cada día contigo cuenta por dos.',
      'Eres arte en movimiento.','Tu ternura me desarma.','Me encantan tus detalles inesperados.',
      'Cuando me miras, todo se ordena.','Eres la parte favorita de mis planes.','Qué suerte la mía de coincidir contigo.',
      'Te queda precioso ser tú.','Gracias por existir.'
    ];
    let restantes = JSON.parse(localStorage.getItem(CUMPLIDOS_KEY) || 'null');
    if(!Array.isArray(restantes) || !restantes.length) restantes=[...CUMPLIDOS_BASE];

    const out=qs('#cumplido');
    qs('#btn-ruleta').onclick=()=>{
      if(!restantes.length){
        out.textContent='¡Se acabaron! Reinicia para volver a girar ✨';
        return;
      }
      const i=Math.floor(Math.random()*restantes.length);
      const txt=restantes.splice(i,1)[0];
      localStorage.setItem(CUMPLIDOS_KEY, JSON.stringify(restantes));
      out.textContent=txt;
      confetti();
    };
    qs('#btn-reset-ruleta').onclick=()=>{
      restantes=[...CUMPLIDOS_BASE];
      localStorage.setItem(CUMPLIDOS_KEY, JSON.stringify(restantes));
      out.textContent='Lista reiniciada. ¡Gira de nuevo! 💫';
    };

    // ========= Palabras que te describen =========
    const PAL_KEY='palabras_v2';
    let palabras = JSON.parse(localStorage.getItem(PAL_KEY) || '[]');
    const cont=qs('#burbujas');
    const SUGERENCIAS=['valiente','brillante','dulce','tierna','auténtica','creativa','paciente','soñadora','divertida','apasionada','generosa','detallista','luminosa','leal','sincera','encantadora','talentosa','resiliente','cariñosa','increíble','guapísima','admirable','mágica','única','tranquila','inteligente','chispita','mi persona'];

    function savePal(){ localStorage.setItem(PAL_KEY, JSON.stringify(palabras)); }
    function renderPal(){
      cont.innerHTML='';
      if(!palabras.length){ cont.innerHTML='<span class="muted">Aún no hay palabras. Agrega la primera ✨</span>'; return; }
      palabras.forEach((txt,i)=>{
        const b=document.createElement('span'); b.className='burbuja';
        b.style.setProperty('--rot', (Math.random()*8-4)+'deg');
        b.innerHTML = `${txt} <button class="x" title="Quitar" aria-label="Quitar">✕</button>`;
        b.querySelector('.x').onclick=()=>{ palabras.splice(i,1); savePal(); renderPal(); };
        cont.appendChild(b);
      });
    }
    renderPal();

    qs('#palabra-add').onclick=()=>{
      const t=qs('#palabra-text').value.trim();
      if(!t) return alert('Escribe una palabra');
      palabras.push(t);
      qs('#palabra-text').value='';
      savePal(); renderPal();
    };
    qs('#palabra-sugerir').onclick=()=>{
      const pool=[...SUGERENCIAS].filter(x=>!palabras.includes(x));
      for(let k=0;k<5 && pool.length;k++){
        const i=Math.floor(Math.random()*pool.length);
        palabras.push(pool.splice(i,1)[0]);
      }
      savePal(); renderPal();
    };
    qs('#palabra-clear').onclick=()=>{
      if(confirm('¿Vaciar todas las palabras?')){ palabras=[]; savePal(); renderPal(); }
    };

    // focus
    qsa('button, input').forEach(el=>{ el.addEventListener('focus',()=>el.style.outline='2px solid var(--accent)'); el.addEventListener('blur',()=>el.style.outline='none'); });

    // Ajustes
    const dlgAj=qs('#dlg-ajustes');
    qs('#btn-ajustes').onclick=()=>{ qs('#inp-para').value=nombre; qs('#inp-de').value=de; dlgAj.showModal(); };
    qs('#aj-cancel').onclick=()=>dlgAj.close();
    qs('#aj-guardar').onclick=()=>{ 
      const n=qs('#inp-para').value.trim()||'Ti'; 
      const d=qs('#inp-de').value.trim()||'mí'; 
      localStorage.setItem('para',n); localStorage.setItem('de',d); 
      const u=new URL(location.href);
      u.searchParams.set('para', n); u.searchParams.set('de', d);
      location.search = u.search;
    };

    // ===== Service Worker con auto-update =====
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const reg = await navigator.serviceWorker.register('./sw.js');
          navigator.serviceWorker.addEventListener('controllerchange', () => location.reload());
          if (reg.waiting) reg.waiting.postMessage('SKIP_WAITING');
          reg.onupdatefound = () => {
            const nw = reg.installing;
            if (!nw) return;
            nw.onstatechange = () => {
              if (nw.state === 'installed' && navigator.serviceWorker.controller) {
                nw.postMessage('SKIP_WAITING');
              }
            };
          };
        } catch {}
      });
    }
  </script>
</body>
</html>
